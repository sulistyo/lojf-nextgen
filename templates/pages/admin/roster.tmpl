{{define "content"}}
<h1 class="text-2xl font-bold mb-4">Admin • Roster</h1>
{{template "admin_nav" .}}

<form method="GET" class="bg-white p-4 border rounded-2xl grid md:grid-cols-5 gap-3 mb-4">
  <div>
    <label class="block text-xs text-gray-600 mb-1">From</label>
    <input type="date" name="from" value="{{.Filters.From}}" class="w-full rounded-xl border p-2">
  </div>
  <div>
    <label class="block text-xs text-gray-600 mb-1">To</label>
    <input type="date" name="to" value="{{.Filters.To}}" class="w-full rounded-xl border p-2">
  </div>
  <div>
    <label class="block text-xs text-gray-600 mb-1">Class</label>
    <select name="class_id" class="w-full rounded-xl border p-2">
      <option value="">All</option>
      {{range .Classes}}
        <option value="{{.ID}}" {{if eq (printf "%d" .ID) $.Filters.ClassID}}selected{{end}}>{{.Name}} — {{.Date}}</option>
      {{end}}
    </select>
  </div>
  <div>
    <label class="block text-xs text-gray-600 mb-1">Status</label>
    <select name="status" class="w-full rounded-xl border p-2">
      <option value="" {{if eq .Filters.Status ""}}selected{{end}}>All</option>
      <option value="confirmed" {{if eq .Filters.Status "confirmed"}}selected{{end}}>Confirmed</option>
      <option value="waitlisted" {{if eq .Filters.Status "waitlisted"}}selected{{end}}>Waitlisted</option>
      <option value="checked-in" {{if eq .Filters.Status "checked-in"}}selected{{end}}>Checked-in</option>
    </select>
  </div>
  <div class="flex gap-2 items-end">
    <button class="px-3 py-2 rounded-xl bg-gray-900 text-white">Filter</button>
    <a class="px-3 py-2 rounded-xl border"
       href="/admin/roster.csv?from={{.Filters.From}}&to={{.Filters.To}}&class_id={{.Filters.ClassID}}&status={{.Filters.Status}}">Export CSV</a>
  </div>
</form>

<div class="bg-white border rounded-2xl overflow-x-auto">
  {{if .HasResult}}
  <table class="w-full text-sm">
    <thead>
      <tr class="text-left text-sm text-gray-600">
        <th class="py-2 px-3">Date</th>
        <th class="py-2 px-3">Class</th>
        <th class="py-2 px-3">Child</th>
        <th class="py-2 px-3">Parent</th>  
        <th class="py-2 px-3">Code</th>    
        <th class="py-2 px-3">Status</th>
        <th class="py-2 px-3">Check-in</th>
        <th class="py-2 px-3">Actions</th>
      </tr>
    </thead>    
    <tbody>
      {{range .Rows}}
      <tr class="border-t">

          <td class="py-2 px-3 whitespace-nowrap">{{.DateStr}}</td>
          <td class="py-2 px-3 whitespace-nowrap">{{.ClassName}}</td>
          <td class="py-2 px-3">{{.ChildName}}</td>
          <td class="py-2 px-3">
            
            <!-- (optional) link to parent detail -->
            <a class="underline ml-1" href="/admin/parents/{{.ParentID}}">{{.ParentName}}</a>
          </td>
          <td class="py-2 px-3 whitespace-nowrap">
            <span class="font-mono">{{.Code}}</span>
            <a class="inline-block align-middle ml-2" href="/qr/{{.Code}}.png" target="_blank" title="Show QR">
              <!-- small QR icon (inline SVG) -->
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="opacity:.85">
                <path d="M2 2h4v4H2V2zm1 1v2h2V3H3zM10 2h4v4h-4V2zm1 1v2h2V3h-2zM2 10h4v4H2v-4zm1 1v2h2v-2H3zM10 9h2v2h-2V9zm3 0h1v1h1v1h-2V9zm-3 3h1v1h-1v-1zm2 0h3v3h-3v-3z"/>
              </svg>
            </a>
          </td>

          <td class="py-2 px-3">
            {{if eq .Status "waitlisted"}}Waitlist (#{{.WaitlistRank}}){{else}}{{.Status}}{{end}}
          </td>
          <td class="py-2 px-3 whitespace-nowrap">{{.CheckInStr}}</td>
          <td class="py-2 px-3 whitespace-nowrap space-x-2">
            <form method="POST" action="/admin/registrations/{{.ID}}/checkin" style="display:inline">
              <button class="text-xs underline" {{if eq .Status "waitlisted"}}disabled style="opacity:.4; text-decoration:none"{{end}}>Check-in</button>
            </form>
            <form method="POST" action="/admin/registrations/{{.ID}}/cancel" style="display:inline">
              <button class="text-xs underline">Cancel</button>
            </form>
            <form method="POST" action="/admin/registrations/{{.ID}}/delete" style="display:inline" onsubmit="return confirm('Delete this registration?')">
              <button class="text-xs underline">Delete</button>
            </form>
          </td>
        </tr>
      {{end}}
    </tbody>
  </table>
  {{else}}
  <div class="p-6 text-gray-600">No registrations match your filters.</div>
  {{end}}
</div>
{{end}}
{{define "admin/roster.tmpl"}}{{template "base" .}}{{end}}
