{{define "content"}}
<h1 class="text-2xl font-bold mb-4">Admin • Roster</h1>
{{template "admin_nav" .}}

<form method="GET" class="bg-white p-4 border rounded-2xl grid md:grid-cols-5 gap-3 mb-4">
  <div>
    <label class="block text-xs text-gray-600 mb-1">From</label>
    <input type="date" name="from" value="{{.Filters.From}}" class="w-full rounded-xl border p-2">
  </div>
  <div>
    <label class="block text-xs text-gray-600 mb-1">To</label>
    <input type="date" name="to" value="{{.Filters.To}}" class="w-full rounded-xl border p-2">
  </div>
  <div>
    <label class="block text-xs text-gray-600 mb-1">Class</label>
    <select name="class_id" class="w-full rounded-xl border p-2">
      <option value="">All</option>
      {{range .Classes}}
        <option value="{{.ID}}" {{if eq (printf "%d" .ID) $.Filters.ClassID}}selected{{end}}>{{.Name}} — {{.Date}}</option>
      {{end}}
    </select>
  </div>
  <div>
    <label class="block text-xs text-gray-600 mb-1">Status</label>
    <select name="status" class="w-full rounded-xl border p-2">
      <option value="" {{if eq .Filters.Status ""}}selected{{end}}>All</option>
      <option value="confirmed" {{if eq .Filters.Status "confirmed"}}selected{{end}}>Confirmed</option>
      <option value="waitlisted" {{if eq .Filters.Status "waitlisted"}}selected{{end}}>Waitlisted</option>
      <option value="checked-in" {{if eq .Filters.Status "checked-in"}}selected{{end}}>Checked-in</option>
    </select>
  </div>
  <div class="flex gap-2 items-end">
    <button class="px-3 py-2 rounded-xl bg-gray-900 text-white">Filter</button>
    <a class="px-3 py-2 rounded-xl border"
       href="/admin/roster.csv?from={{.Filters.From}}&to={{.Filters.To}}&class_id={{.Filters.ClassID}}&status={{.Filters.Status}}">Export CSV</a>
  </div>
</form>

<div class="bg-white border rounded-2xl overflow-x-auto">
  {{if .HasResult}}
  <table class="w-full text-sm">
    <thead class="text-left text-gray-500">
      <tr>
        <th class="py-2 px-3">Date</th>
        <th class="py-2 px-3">Class</th>
        <th class="py-2 px-3">Child</th>
        <th class="py-2 px-3">Code</th>
        <th class="py-2 px-3">Status</th>
        <th class="py-2 px-3">Check-in</th>
        <th class="py-2 px-3">Actions</th>
      </tr>
    </thead>
    <tbody>
      {{range .Rows}}
      <tr class="border-t">
        <td class="py-2 px-3 whitespace-nowrap">{{.DateStr}}</td>
        <td class="py-2 px-3">{{.ClassName}}</td>
        <td class="py-2 px-3">{{.ChildName}}</td>
        <td class="py-2 px-3 font-mono">{{.Code}}</td>
        <td class="py-2 px-3">
          {{if eq .Status "confirmed"}}
            <span class="inline-block px-2 py-0.5 rounded-xl bg-green-100 text-green-700 text-xs">confirmed</span>
          {{else if eq .Status "waitlisted"}}
            <span class="inline-block px-2 py-0.5 rounded-xl bg-yellow-100 text-yellow-700 text-xs">
              waitlisted{{if .WaitlistRank}} #{{.WaitlistRank}}{{end}}
            </span>
          {{else}}
            <span class="inline-block px-2 py-0.5 rounded-xl bg-gray-100 text-gray-700 text-xs">{{.Status}}</span>
          {{end}}
        </td>
        <td class="py-2 px-3">{{.CheckInStr}}</td>
        <td class="py-2 px-3 whitespace-nowrap space-x-2">
          <a class="text-xs underline" href="/admin/classes/{{.ClassID}}/edit">Edit Class</a>
          {{if eq .Status "confirmed"}}
            <form method="POST" action="/admin/registrations/{{.ID}}/checkin" style="display:inline">
              <button class="text-xs underline">Check-in</button>
            </form>
          {{else}}
            <span class="text-xs text-gray-400 line-through cursor-not-allowed">Check-in</span>
          {{end}}
          <form method="POST" action="/admin/registrations/{{.ID}}/cancel" style="display:inline">
            <button class="text-xs underline">Cancel</button>
          </form>
          <form method="POST" action="/admin/registrations/{{.ID}}/delete" style="display:inline">
            <button class="text-xs underline">Delete</button>
          </form>
        </td>
      </tr>
      {{end}}
    </tbody>
  </table>
  {{else}}
  <div class="p-6 text-gray-600">No registrations match your filters.</div>
  {{end}}
</div>
{{end}}
{{define "admin/roster.tmpl"}}{{template "base" .}}{{end}}
